<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name=”robots” content=”index,nofollow”>
    <meta http-equiv ='content-language' content ='zh-cn'>

    <meta name="keywords" content="班蔚,bluvarri,数字游民,Freelancer,up主商业化数字工作室,自由职业,超级玩家,写作与翻译,原神超级玩家,视频与动画制作剪辑">
    <meta name="description" content="查找你正在寻找的服务，比较价格，预约服务，敲定服务内容，分阶段交付">
    <link rel="icon" href="https://www.bluvarri.com/favicon.png">
    <title>精选专业服务  :-r  班蔚</title>
    <link rel="stylesheet" href="/common/stylesheets/style.scss">
    <link rel="stylesheet" href="/mall/stylesheets/cell-widget.scss">

</head>
<body>
    <div id="app">
        <div class="page-container">
            <h1>服务推荐</h1>
            <div class="cell-grid">
                <div class="cell-content">
                </div>
                <div class="explore-more">
                    <a href="/mall/gig-economy" target="_blank" class="go-mall">浏览更多服务</a>
                    <a href="/rainbow/discovery-commercial-order" target="_blank" class="go-micro">前往商单发布需求</a>
                </div>
            </div>

        </div>
    </div>
    <script>
        async function handleErrors(response) {
            if (!response.ok){
            throw Error(response.statusText);
            } 
            return response;
        }
        function getQueryVariable(variable){
                const url = new URL(window.location.href);
                const value = url.searchParams.get(variable);
                return value;
        }
        async function fetchProduct(influencer,chn,sort){
            const url="/api/open/affiliate/choice_product?current=1&size=130&influencer="+influencer+"&chn="+chn + "&sort=" + sort;
            return await fetch(url);
        }

        function createCellItem(el){
          const cellItem=document.createElement("div");
          cellItem.className = "cell-item";

          const cellCard=document.createElement("div");
          cellCard.className = "cell-card";

          const cellCoverLink=document.createElement("a");
          cellCoverLink.className = "cell-cover-link";
          cellCoverLink.href=el.affiliateLink;
          const cellCoverImg=new Image();
          cellCoverImg.className = "cell-cover-image";
          cellCoverImg.src=el.thumbnail;
          cellCoverImg.alt="product thumbnail";
          cellCoverImg.onerror=function(){
            cellCoverImg.src="https://d13-content.oss-cn-hangzhou.aliyuncs.com/common/image/default-cell-preview.jpg";
          }


          const cellBrand=document.createElement("a");
          cellBrand.className = "cell-brand";
          cellBrand.href=el.affiliateLink;
          const cellBrandImg=new Image();
          cellBrandImg.className = "cell-brand-image";
          cellBrandImg.src=el.brandAvatar;
          cellBrandImg.alt="brand avatar";
          cellBrandImg.onerror=function(){
            cellBrandImg.src="https://d13-content.oss-cn-hangzhou.aliyuncs.com/common/image/panda-kawaii.svg";
          }
          
          const cellBrandName=document.createElement("span");
          cellBrandName.className = "cell-brand-name ellipsis-1";
          cellBrandName.textContent=el.brandName;

          const cellTitle=document.createElement("a");
          cellTitle.className = "cell-title ellipsis-2";
          cellTitle.textContent = el.productName;
          cellTitle.href=el.affiliateLink;

          const cellPrice=document.createElement("a");
          cellPrice.className = "cell-price";
          cellPrice.textContent=" 冰点价 ";
          cellPrice.href=el.affiliateLink;

          const cellPriceIns=document.createElement("span");
          cellPriceIns.className = "cellPrice-ins";
          cellPriceIns.textContent="￥"+el.productPrice;
          
          var exampleFrag = document.createDocumentFragment();
          var exampleCellCard= exampleFrag.appendChild(cellItem).appendChild(cellCard);

          exampleCellCard.appendChild(cellCoverLink).appendChild(cellCoverImg);
          var brandInfo= exampleCellCard.appendChild(cellBrand);
            brandInfo.append(cellBrandImg);
            brandInfo.append(cellBrandName);
          exampleCellCard.appendChild(cellTitle);
          exampleCellCard.appendChild(cellPrice).appendChild(cellPriceIns);

          document.querySelector(".cell-content").appendChild(exampleFrag);


        }
        
       async function loadProduct(){
          const influencer=getQueryVariable("influencer");
          const chn=getQueryVariable("chn");
          const sort=getQueryVariable("sort");

          
          const response = await fetchProduct(influencer,chn,sort);
            var data = await response.json();
            if(data.code==200){
                data.product.records.forEach(element => {
                    createCellItem(element);
                });
            }
       }

       // init
       loadProduct();

    </script>
    
    
    <script type="module" src="/common/javascripts/baidutongji.js"></script>
</body>

</html>