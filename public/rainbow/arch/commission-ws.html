<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index,follow">
    <meta http-equiv ='content-language' content ='zh-cn'>

    <link rel="icon" href="https://www.bluvarri.com/favicon.png">
    <title>委托空间</title>

    <link rel="stylesheet" href="/common/stylesheets/style.scss">
    <link rel="stylesheet" href="/common/stylesheets/millstone-chat-compoent.scss">
  <link rel="stylesheet" href="/rainbow/arch/stylesheets/commission-ws.scss">


</head>
<body>
    <mall-app id="app" v-cloak>
      <div class="app-container">
        <!-- header nav -->
        <header class="text-white">
          <div class="d-flex justify-content-between align-items-center hdlayout">

            <div class="d-flex align-items-center">
              
              <a href="/rainbow/teixcalaanli">
                <div class="d-flex align-items-center logo">
                  <img src="/common/icon/logo_blv-final-white.png" alt="logo">
                  <h2 class="mb-0 ms-2 font-biaotihei">彩虹部落</h2>
                </div>
              </a>

            </div>
            
            <div>
              
              <div class="btn-group" style="margin-right: 8px;" >
              
                <button type="button" class="btn entry-nav" data-bs-toggle="dropdown" aria-expanded="false" >
                  <div class="tooltip-nav" data-bs-toggle="tooltip" data-bs-custom-class="custom-tooltip" data-bs-trigger="hover" data-bs-placement="bottom" data-bs-title="访达">
                    <i class="bi bi-grid"></i>                  
                  </div>
                </button>
                <ul class="dropdown-menu dropdown-menu-end dropdown-dark">
                  <li>
                    <a href="/">
                      <button class="dropdown-item" type="button">
                        <img class="forward-icon me-2" src="/common/icon/logo_blv-final-black.png" alt="blv-logo"> 主站首页
                      </button>
                    </a>
                  </li>
                  <li>
                    <a href="/rainbow/teixcalaanli">
                      <button class="dropdown-item" type="button">
                        <i class="bi bi-rainbow me-2"></i> 彩虹部落
                      </button>
                    </a>
                  </li>
                  <li>
                    <a href="/mall/gig-economy">
                      <button class="dropdown-item" type="button">
                        <i class="bi bi-bag-heart me-2"></i> 心选商店
                      </button>
                    </a>
                  </li>
                  <li>
                    <a href="/affiliate/dashboard">
                      <button class="dropdown-item" type="button" >
                        <i class="bi bi-megaphone me-2"></i> 带货中心
                      </button>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/epod/pod-packages-order">
                      <button class="dropdown-item" type="button" >
                        <i class="bi bi-tags me-2"></i> 奇迹工坊
                      </button>
                    </a>
                  </li>

                  <li>
                    <a href="/estudio/studio-dashboard">
                      <button class="dropdown-item" type="button" >
                        <i class="bi bi-flower1 me-2"></i> 薪动商号
                      </button>
                    </a>
                  </li>
                </ul>

              </div>

            

              <div class="btn-group private-msg-atom" style="margin-right: 8px;">
                <button type="button" class="btn entry-nav" data-bs-toggle="dropdown" aria-expanded="false">
                  <div class="tooltip-nav" data-bs-custom-class="custom-tooltip" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-trigger="hover" data-bs-title="消息">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M2.80403 8.3533C2.52389 10.9562 2.53637 13.9582 2.9262 16.5505C3.1419 17.9849 4.31257 19.0845 5.75763 19.2102L7.26787 19.3414C10.4169 19.6152 13.5838 19.6152 16.7328 19.3414L18.2431 19.2102C19.6881 19.0845 20.8588 17.9849 21.0745 16.5505C21.4643 13.9582 21.4768 10.9564 21.1967 8.35345C21.1605 8.05169 21.1197 7.75034 21.0745 7.44949C20.8588 6.0151 19.6881 4.91545 18.2431 4.78983L16.7328 4.65855C13.5838 4.38481 10.4169 4.38481 7.26787 4.65855L5.75763 4.78983C4.31257 4.91545 3.1419 6.0151 2.9262 7.44949C2.88096 7.75028 2.84024 8.05159 2.80403 8.3533ZM7.39777 6.15292C10.4604 5.88669 13.5403 5.88669 16.6029 6.15292L18.1131 6.2842C18.8675 6.34977 19.4786 6.92379 19.5912 7.67254C19.6029 7.7503 19.6142 7.82809 19.6253 7.90592L14.0643 10.9954C12.7807 11.7085 11.2199 11.7085 9.93632 10.9954L4.37539 7.90596C4.38645 7.82812 4.39783 7.75031 4.40952 7.67254C4.52211 6.92379 5.13321 6.34977 5.88754 6.2842L7.39777 6.15292ZM19.8088 9.51989C20.0028 11.7876 19.9303 14.0725 19.5912 16.3274C19.4786 17.0762 18.8675 17.6502 18.1132 17.7158L16.6029 17.8471C13.5403 18.1133 10.4604 18.1133 7.39777 17.8471L5.88754 17.7158C5.13321 17.6502 4.52211 17.0762 4.40952 16.3274C4.07043 14.0725 3.99787 11.7877 4.19184 9.51992L9.20786 12.3066C10.9445 13.2714 13.0561 13.2714 14.7928 12.3066L19.8088 9.51989Z" fill="white"/>
                      </svg>  
                  </div>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <div class="friend-header">
                    私信（{{friends.totalUnRead}}）
                  </div>
                  <div class="friend-list">

                    <li class="friend-item"   v-for="friend in friends.records">
                      <a target="_blank" :href="'/messages/'+ friend.id">
                        <div class="friend-container">
                          <div class="frend-avatar-container">
                            <img class="frend-avatar" :src="adaptiveImageUriV(friend.avatar) || defaultAvatarImage" @error.once="e => { e.target.src = defaultAvatarImage }">
                            <div v-if="friend.brandMark=='3'" class="online-indicator">
                              <div class="online-indicator-content">
                              </div>
                            </div>
                          </div>
                          <div class="friend-info">
                            <div class="friend-name"><span class="ellipsis-1">{{friend.title}}</span> </div>
                            <div class="friend-msg"> <span class="ellipsis-1">{{friend.latestContent}}</span> </div>
                            <div class="msg-time">{{getPublishTimeV(friend.modifiedAt)}}</div>
                          </div>
                        </div>
                      </a>
                    </li>

                  

                  </div>
                  


                </ul>
              </div>

              <div class="btn-group">
                <button type="button" class="btn btn-secondary dropdown-toggle button_user_vue brand-avatar" data-bs-toggle="dropdown" aria-expanded="false">
                  <img  :src="adaptiveImageUriV(getIdentity().avatar)  || defaultAvatarImage" @error.once="e => { e.target.src = defaultAvatarImage }">
                </button>
                <ul class="dropdown-menu dropdown-menu-end dropdown-dark">
                  <li>
                    <a href="/estudio/studio-setting-profile">
                      <button class="dropdown-item" type="button">
                        <i class="bi bi-person-vcard me-2"></i> 品牌形象
                      </button>
                    </a>
                  </li>
                  <li>
                      <button @click="logout()" class="dropdown-item" type="button">   
                        <i class="bi bi-box-arrow-right me-2"></i> 退出登录 
                      </button>
                  </li>
                  <li>
                    <a href="/mall/delete-account">
                      <button class="dropdown-item" type="button">
                        <i class="bi bi-trash3 me-2"></i> 删除账号
                      </button>
                    </a>
                  </li>
                  
                  <li>
                    <button class="dropdown-item" type="button" data-bs-toggle="offcanvas" data-bs-target="#feedback_offcanvas_right" aria-controls="feedback_offcanvas_right">
                      <i class="bi bi-flag me-2"></i> 问题反馈
                    </button>
                  </li>
                </ul>
              </div>
      
              
            </div>


          </div>
        </header>
        <content>
          <main class="content-main">
            <div class="data-tag">快速访问</div>
            <div class="nav-tabs-container">

              <ul class="nav nav-tabs border-0" id="bubble-tab" role="tablist">
                <li class="nav-item" role="presentation">
                  <a class="text-decoration-none" :href="'/rainbow/oasis/commission?oasis_id=' + commissionDetail.oasisId">
                    <button class="nav-link">部落委托</button>
                  </a>
                </li>
                <li class="nav-item" role="presentation">
                  <a class="text-decoration-none" :href="'/rainbow/oasis/home?oasis_id=' + commissionDetail.oasisId">
                    <button class="nav-link">部落主页</button>
                  </a>
                </li>
                <li class="nav-item" role="presentation">
                  <a class="text-decoration-none" :href="'/rainbow/arch/channel-0001?oasis_id=' + commissionDetail.oasisId">
                    <button class="nav-link">部落日常</button>
                  </a>
                </li>
              </ul>

            </div>

            <div class="nav-tabs-container" style="height: 54px;">
              <ul class="nav nav-tabs" id="tob-tablist" role="tablist">
                <li class="nav-item" role="presentation">
                <button class="nav-link active" id="sow-tab" data-bs-toggle="tab" data-bs-target="#sow-tab-pane" type="button" role="tab" aria-controls="sow-tab-pane" aria-selected="true">
                  <i class="bi bi-briefcase"></i>
                  服务内容
                </button>
                </li>
                <li class="nav-item" role="presentation">
                <button class="nav-link" id="event-tab" data-bs-toggle="tab" data-bs-target="#event-tab-pane" type="button" role="tab" aria-controls="event-tab-pane" aria-selected="true">
                  <i class="bi bi-chat-dots"></i>
                  沟通
                </button>
                </li>
                <li class="nav-item" role="presentation">
                <button class="nav-link" id="deliver-tab" data-bs-toggle="tab" data-bs-target="#deliver-tab-pane" type="button" role="tab" aria-controls="deliver-tab-pane" aria-selected="true">
                  <i class="bi bi-box-seam"></i>
                  交付
                </button>
                </li>
              </ul>
            </div>

             <!-- tab content -->
            <div class="tab-content">
              <div class="tab-pane fade" id="event-tab-pane" role="tabpanel" aria-labelledby="event-tab" tabindex="0">
                <div class="room-msg-panel">

                  <div class="room-msg-container">

                    <div v-for="(item,i) in eventObj.records" class="event-date">
                      <a class="btn btn-dark tag-collapse-ctl" data-bs-toggle="collapse" :href="'#block_'+i" role="button" :aria-expanded="eventObj.records.length<3 || i > eventObj.records.length-3">
                        <div class="bi date-tag">{{item.stampDate}}</div>
                      </a>
                      <div class="collapse" 
                      :class="{'show': eventObj.records.length<3 || i > eventObj.records.length-3 }"
                         :id="'block_'+i">
                        <section v-for="record in item.cards" class="event-wrapper new-order">
                          <label>
                            <span class="event-icon new-order">
                                <img :src="adaptiveImageUriV(record.authorIcon)  || defaultAvatarImage" @error.once="e => { e.target.src = defaultAvatarImage }">
                            </span>
                            <p class="event-header-base border-0">
                              <span class="event-title">{{record.author}}</span>
                              <i class="simple-time ms-2"> {{record.createAt.substr(-8,8)}}</i>
                            </p>
                          </label>
                          <div class="event-msg-content">
                            <p v-if="record.msgType === 'text'" class="text-preline text-message">{{JSON.parse(record.msg).content}}</p>
                            <div  v-if="record.msgType === 'image'">
                              <a target="_blank" :href="'/mall/preview?uri='+JSON.parse(record.msg).uri" rel="noopener noreferrer">
                                <img  :src="JSON.parse(record.msg).uri" class="img-message">
                              </a>
                              <p>
                                <a target="_blank" class="download" download="" :href="JSON.parse(record.msg).uri"><i class="bi bi-cloud-arrow-down content-download-icon"></i></a>
                              </p>
                            </div>
                            <div v-if="record.msgType === 'attachment'">
                              <div class="attachment-message">
                                <span> {{JSON.parse(record.msg).fileName}}</span>
                                <i class="bi bi-file-earmark"></i>
                              </div>
                              <p><a target="_blank" class="download" :download="JSON.parse(record.msg).fileName" :href="JSON.parse(record.msg).uri"><i class="bi bi-cloud-arrow-down content-download-icon"></i></a></p>
                            </div>
                          </div>
                        </section>
                      </div>
                      
                    </div>

                  </div>

                  <div class="chat-input-wrapper">
                    <div class="input-wrapper">
                      <textarea @input="autoHeightV($event)" id="twemoji-picker" class="chat-input" placeholder="在这输入消息..."></textarea>
                    </div>
                    <div class="chat-action-wrapper">
                      <div class="chat-action-option">
                        <span>
                          <div class="chat-attachment-btn chat-btn-container">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="feather feather-paperclip" viewBox="0 0 24 24">
                              <defs></defs>
                              <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"></path>
                            </svg>
                            <input @change="handleBigFileChange($event)" id="selection_attachment" type="file" class="input-file">
                          </div>
                        </span>
                        <span>
                          <div id="selection-outer" class="selection-outer ms-2 chat-btn-container">
                            <div id="selection">
                              <button id="selection-emoji" class="empty emoji-btn">
                                <i class="bi bi-emoji-smile"></i>
                              </button>
                            </div>
                          </div>
                        </span>
                        <span>
                          <div class="ms-2 chat-btn-container">
                            <div class="img-btn" >
                              <i class="bi bi-image chat-image-btn"></i>
                              <input @change="handleFileChange($event)" type="file"   id="selection_image" class="input-file">
                            </div>
                          </div>
                        </span>
                      </div>
                      <button v-preventreclick @click="sendTextMessageV" class="chat-send-btn">发送</button>
                    </div>
                  </div>

                  

                  


                </div>

                

                
                

              </div>
            <!-- event tab end -->
            <!-- sow tab begin -->
              <div class="tab-pane fade show active" id="sow-tab-pane" role="tabpanel" aria-labelledby="sow-tab" tabindex="0">

                <div class="commission-info-container pb-5">

                  <!-- 顶部信息条 -->
                  <div class="sow-hero">
                    <div class="sow-header">
                      <div class="sow-tag">
                        <i class="bi bi-lightning-charge-fill"></i>
                        {{explainOasisCommissionTagV(commissionDetail.tag)}}
                      </div>
                      <div class="sow-price">
                        <span class="price-currency">￥</span>{{commissionDetail.bonus}}
                      </div>
                    </div>
                    <h1 class="sow-title">{{commissionDetail.title}}</h1>
                    <div v-if="commissionDetail.supplierName" class="sow-meta">
                      <div class="meta-item">
                        <img :src="adaptiveImageUriV(commissionDetail.supplierAvatar) || defaultAvatarImage" @error.once="e => { e.target.src = defaultAvatarImage }">
                        <span>{{commissionDetail.supplierName}}</span>
                      </div>
                    </div>
                  </div>

                  <!-- 服务描述 -->
                  <div class="sow-description">
                    <div class="description-header">
                      <i class="bi bi-file-text"></i>
                      <span>服务说明</span>
                    </div>
                    <div class="description-content">
                      <p>{{commissionDetail.sow}}</p>
                    </div>
                  </div>

                </div>

              </div>
            <!-- sow tab end -->
            <!-- deliver tab begin -->
              <div class="tab-pane fade" id="deliver-tab-pane" role="tabpanel" aria-labelledby="deliver-tab" tabindex="0">
                
                <div class="deliver-panel-container">

                  <div v-if="commissionDetail.tag==='2' && mpdc__paperDeliver.role==='supplier' && !taskInConfirmIngV()"  class="deliver-panel-header">
                    <div @click="showAddNewDeliverModalV" class="btn-container">
                      <div class="package-icon">
                        <i class="bi bi-file-earmark-plus"></i>
                      </div>
                      <span class="paper-head">提交新交付</span>
                    </div>
                  </div>

                  <div v-show="isEmptyObjectV(mpdc__paperDeliver.records)" class="content-block">
                    <span v-if="commissionDetail.tag!='3'">还没有交付记录</span>
                  </div>

                  <!-- role is supplier start -->
                  <div v-if="mpdc__paperDeliver.role==='supplier'" class="deliver-record-container">
                    <div v-for="(record, index) in mpdc__paperDeliver.records" :key="index" class="deliver-record">
                      <div class="record-header">
                        <div class="record-index">#{{index + 1}}</div>
                        <div class="record-meta">
                          <span class="record-time">{{record.createAt.replace(new RegExp('-', 'g'), '/')}}</span>
                          <div class="record-status" :class="{'status-pending': record.tag=='1', 'status-accepted': record.tag=='3', 'status-revision': record.tag=='2'}">
                            {{paperDeliverTagExplainV(record.tag)}}
                          </div>
                        </div>
                      </div>
                      <div class="record-content">
                        <a target="_blank" class="file-row" :download="record.deliverName" :href="record.deliver">
                          <i class="bi bi-file-earmark"></i>
                          <span class="file-label">交付文件</span>
                          <span class="file-name">{{record.deliverName}}</span>
                          <i class="bi bi-download"></i>
                        </a>
                        <a target="_blank" class="file-row preview" :download="record.previewName" :href="record.preview">
                          <i class="bi bi-file-earmark"></i>
                          <span class="file-label">预览文件</span>
                          <span class="file-name">{{record.previewName}}</span>
                          <i class="bi bi-download"></i>
                        </a>
                      </div>
                      <div v-if="record.msg" class="record-msg">
                        <i class="bi bi-chat-left-text"></i>
                        <span>{{record.msg}}</span>
                      </div>
                    </div>
                  </div>
                <!-- role is supplier end -->
                <!-- role is viewer start -->
                <div v-if="mpdc__paperDeliver.role==='viewer'" class="deliver-record-container">
                  <div v-for="(record, index) in mpdc__paperDeliver.records" :key="index" class="deliver-record">
                    <div class="record-header">
                      <div class="record-index">#{{index + 1}}</div>
                      <div class="record-meta">
                        <span class="record-time">{{record.createAt.replace(new RegExp('-', 'g'), '/')}}</span>
                        <div class="record-status" :class="{'status-pending': record.tag=='1', 'status-accepted': record.tag=='3', 'status-revision': record.tag=='2'}">
                          {{paperDeliverTagExplainV(record.tag)}}
                        </div>
                      </div>
                    </div>
                    <div class="record-content">
                      <a v-if="record.tag=='3'" target="_blank" class="file-row" :download="record.deliverName" :href="record.deliver">
                        <i class="bi bi-file-earmark"></i>
                        <span class="file-label">交付文件</span>
                        <span class="file-name">{{record.deliverName}}</span>
                        <i class="bi bi-download"></i>
                      </a>
                      <a v-else target="_blank" class="file-row preview" :download="record.previewName" :href="record.preview">
                        <i class="bi bi-file-earmark"></i>
                        <span class="file-label">预览文件</span>
                        <span class="file-name">{{record.previewName}}</span>
                        <i class="bi bi-download"></i>
                      </a>
                    </div>
                    <div v-if="record.msg" class="record-msg">
                      <i class="bi bi-chat-left-text"></i>
                      <span>{{record.msg}}</span>
                    </div>
                  </div>
                </div>
                <!-- role is viewer end -->
                   
                  <!-- role is admin start -->

                  <div v-if="mpdc__paperDeliver.role==='admin'" class="deliver-record-container">
                    <div v-for="(record, index) in mpdc__paperDeliver.records" :key="index" class="deliver-record" :class="{'is-pending': record.tag=='1'}">
                      <div class="record-header">
                        <div class="record-index">#{{index + 1}}</div>
                        <div class="record-meta">
                          <span class="record-time">{{record.createAt.replace(new RegExp('-', 'g'), '/')}}</span>
                          <div class="record-status" :class="{'status-pending': record.tag=='1', 'status-accepted': record.tag=='3', 'status-revision': record.tag=='2'}">
                            {{paperDeliverTagExplainV(record.tag)}}
                          </div>
                        </div>
                      </div>
                      <div class="record-content">
                        <a v-if="record.tag=='3'" target="_blank" class="file-row" :download="record.deliverName" :href="record.deliver">
                          <i class="bi bi-file-earmark"></i>
                          <span class="file-label">交付文件</span>
                          <span class="file-name">{{record.deliverName}}</span>
                          <i class="bi bi-download"></i>
                        </a>
                        <a v-else target="_blank" class="file-row preview" :download="record.previewName" :href="record.preview">
                          <i class="bi bi-file-earmark"></i>
                          <span class="file-label">预览文件</span>
                          <span class="file-name">{{record.previewName}}</span>
                          <i class="bi bi-download"></i>
                        </a>
                      </div>
                      
                      <div v-if="record.msg" class="record-msg">
                        <i class="bi bi-chat-left-text"></i>
                        <span>{{record.msg}}</span>
                      </div>
                      
                      <div v-if="!record.msg && record.tag=='1'" class="record-input">
                        <textarea rows="6" maxlength="600" class="msg-input" placeholder="输入留言..." v-model="record.newMsg"></textarea>
                        <button :class="{'disabled': !record.newMsg}" v-preventreclick class="btn-send-inline" @click="leaveMessageV(record)">
                          <i class="bi bi-send"></i>
                        </button>
                      </div>
                     
                      <div v-show="record.tag=='1'" class="record-actions">
                        <button v-preventreclick @click="revisionPaperDeliverV(record)" class="btn btn-revision">
                          <i class="bi bi-arrow-repeat"></i>退回修订
                        </button>
                        <button v-preventreclick @click="showAcceptDeliverFocusModalV(record)" class="btn btn-accept">
                          <i class="bi bi-check-circle"></i>接受交付
                        </button>
                      </div>
                    </div>
                  </div>

                <!-- role is admin end-->

                </div>
                
                
              </div>

            <!-- deliver tab end -->



            </div>

          </main>

        </content>

      </div>
      <section class="modals">

        <!-- focus modal -->
      <div class="modal-container">
        <div class="modal fade" id="focusModal" data-bs-backdrop="static" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content focus-modal-content">
              <div class="modal-header focus-modal-header">
                <div class="focus-modal-icon">
                  <i class="bi bi-exclamation-circle"></i>
                </div>
                <h1 class="modal-title">操作确认</h1>
              </div>
              <div class="modal-body focus-modal-body">
                <p class="focus-modal-text">{{focusModal.feed}}</p>
              </div>
              <div class="modal-footer focus-modal-footer">
                <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
                  <i class="bi bi-x"></i>取消
                </button>
                <button v-preventreclick @click="focusModal.confirmHandler" type="button" class="btn btn-confirm">
                  <i class="bi bi-check-lg"></i>确定
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

        <div class="modal-container">
          <!-- 交付内容 Modal -->
          <div class="modal fade" id="newDeliverModal" data-bs-backdrop="static" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
              <div class="modal-content deliver-modal-content">
                <div class="modal-header deliver-modal-header">
                  <div class="modal-header-content">
                    <div class="modal-icon">
                      <i class="bi bi-file-earmark-plus"></i>
                    </div>
                    <div class="modal-title-group">
                      <h1 class="modal-title">准备交付内容</h1>
                      <p class="modal-subtitle">上传您的工作成果</p>
                    </div>
                  </div>
                  <button @click="closeDeliverPaperModalHandlerV" type="button" class="btn-close-custom" data-bs-dismiss="modal" aria-label="Close">
                    <i class="bi bi-x-lg"></i>
                  </button>
                </div>
                <div class="modal-body deliver-modal-body">
                  <form onsubmit="return false" class="deliver-form">
                    <!-- 预览文件上传 -->
                    <div class="upload-section">
                      <div class="upload-card" :class="{'has-file': previewFileSelected}">
                        <div class="upload-icon">
                          <i class="bi bi-file-earmark"></i>
                        </div>
                        <div class="upload-info">
                          <div class="upload-label">预览文件</div>
                          <div v-if="previewFileSelected" class="upload-filename">{{previewFileName}}</div>
                          <div v-else class="upload-hint">采购商通过该文件判断是否接受您的交付内容</div>
                          <div class="upload-limit"><i class="bi bi-info-circle"></i> 最大 20MB</div>
                        </div>
                        <label class="upload-action">
                          <input type="file" @change="handlePreviewFileUpload" id="inputPreviewFile" hidden>
                          <span class="upload-btn">
                            <i :class="previewFileSelected ? 'bi bi-arrow-repeat' : 'bi bi-plus-lg'"></i>
                            {{previewFileSelected ? '重新选择' : '选择文件'}}
                          </span>
                        </label>
                      </div>
                    </div>
                    
                    <!-- 交付文件上传 -->
                    <div class="upload-section">
                      <div class="upload-card primary" :class="{'has-file': deliverFileSelected}">
                        <div class="upload-icon">
                          <i class="bi bi-file-earmark"></i>
                        </div>
                        <div class="upload-info">
                          <div class="upload-label">交付文件 <span class="required">*</span></div>
                          <div v-if="deliverFileSelected" class="upload-filename">{{deliverFileName}}</div>
                          <div v-else class="upload-hint">上传最终的交付内容</div>
                          <div class="upload-limit"><i class="bi bi-info-circle"></i> 最大 20MB</div>
                        </div>
                        <label class="upload-action">
                          <input type="file" @change="handleDeliverFileUpload" id="inputDeliverFile" hidden>
                          <span class="upload-btn">
                            <i :class="deliverFileSelected ? 'bi bi-arrow-repeat' : 'bi bi-plus-lg'"></i>
                            {{deliverFileSelected ? '重新选择' : '选择文件'}}
                          </span>
                        </label>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="modal-footer deliver-modal-footer">
                  <button @click="closeDeliverPaperModalHandlerV" type="button" class="btn btn-cancel" data-bs-dismiss="modal">
                    <i class="bi bi-x"></i>取消
                  </button>
                  <button
                    :class="{'disabled': delieverOrPreviewFileIsEmpty || deliverFileSizeExceeded || previewFileSizeExceeded || uploadingDeliverMaterial}"
                    v-preventreclick @click="deliverPaperV" type="button" class="btn btn-submit">
                    <i class="bi bi-send"></i>{{uploadingDeliverMaterial ? '正在上传...' : '提交' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-container">
          <!-- Modal -->
          <div class="modal fade" id="imagePreviewModal" data-bs-backdrop="static" tabindex="-1">
            <div class="modal-dialog  modal-dialog-centered modal-dialog-scrollable">
              <div class="modal-content text-color-dark">
                <div class="modal-header">
                  <h1 class="modal-title fs-5">预览</h1>
                  <button @click="resetFileInput" type="button" id="closeImagePreviewModal" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex justify-content-center">
                  <div v-if="errors.length == 0" class="image-upload-container">
                    <img id="imagePreview" :src="file.url" >
                  </div>
                  <div v-if="errors.length > 0">
                    <div>文件不符合要求，提示信息：</div>
                    <div v-for="error in errors">
                      <span>{{error}}</span>
                    </div>
                  </div>
                </div>
                <div class="modal-footer btn-light">
                  <button @click="sendImageMessageV"
                  :class="{'disabled': errors.length > 0, 
                        'btn-primary': errors.length == 0,
                        'btn-secondary': errors.length > 0}"
                   v-preventreclick type="button" class="btn btn-primary">选中</button>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <div class="modal-container">
          <!-- Modal -->
          <div class="modal fade" id="sendBigFileModal" data-bs-backdrop="static" tabindex="-1">
            <div class="modal-dialog  modal-dialog-centered modal-dialog-scrollable">
              <div class="modal-content text-color-dark">
                <div class="modal-header">
                  <h1 class="modal-title fs-5">文件信息</h1>
                  <button @click="resetBigFileInput" type="button" id="closeSendFileModal" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex justify-content-center">
                  <div v-if="errors.length == 0" class="file-info-container">
                    选中文件: {{bigfile.fileName}}
                  </div>
                  <div v-if="errors.length > 0">
                    <div>文件不符合要求，提示信息：</div>
                    <div v-for="error in errors">
                      <span>{{error}}</span>
                    </div>
                  </div>
                </div>
                <div class="modal-footer btn-light">
                  <button @click="sendAttachmentV"
                  :class="{'disabled': errors.length > 0, 
                        'btn-primary': errors.length == 0,
                        'btn-secondary': errors.length > 0}"
                   v-preventreclick type="button" class="btn btn-primary">发送</button>
                </div>
              </div>
            </div>
          </div>
        </div>
  
      </section>
        
          
    </mall-app>
    <section class="feedback_offcanvas" id="section_feedback_offcanvas">

      <div class="offcanvas offcanvas-end" tabindex="-1" id="feedback_offcanvas_right" aria-labelledby="feedbackOffcanvasRightLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="feedbackOffcanvasRightLabel">发送反馈到小蔚</h5>
          <button id="closeFeedbackOffcanvas" type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <form id="feedback-form">
            <div class="mt-3">
              <label for="input_issue" class="form-label">您遇到的具体问题是什么(必填,300字以内)</label>
              <textarea  rows="8" type="text" maxlength="300" class="form-control"  id="input_issue"></textarea>
            </div> 
            <div class="mt-3">
              <label class="form-label">附件图片(选填)</label>
              <div class="feedback-attachment-upload-container dropzone-wrapper">
                <img  id="lastestFeedbackAttachment" >
                <div class="dropzone-desc">
                  <i class="bi bi-cloud-plus"></i>
                </div>
                <input type="file" id="input_issue_attachment"  accept="image/jpg, image/png, image/jpeg" class="dropzone">
              </div>
            </div>  
            <div class="mt-3">
              <label for="input_issue_contact" class="form-label">您的联系方式(选填)</label>
              <input id="input_issue_contact"  min="1" max="50000" step="1" type="text" class="form-control" placeholder="请留下邮箱或电话，使我们快速反馈">
            </div> 
            <button type="submit" class="btn btn-primary mt-5 w-100">提交</button>
          </form>
        </div>
      </div>
  
    </section>
    <script type="module" src="/common/javascripts/feedback.js"></script>
    <script type="module" src="/common/javascripts/tm.js"></script>
    <script type="module" src="/rainbow/arch/javascripts/commission-ws.js"></script>
    <script>
      function goBack() {
          window.history.back()
       }
    </script>


</body>
</html>